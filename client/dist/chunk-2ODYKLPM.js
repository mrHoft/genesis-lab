import{a as I}from"./chunk-5TDXR2NB.js";import{a as N}from"./chunk-TVGKWIY7.js";import{d as O}from"./chunk-AISLFVIE.js";import{a as L}from"./chunk-6VR75GNB.js";import"./chunk-N65F7NND.js";import{c as T,e as E}from"./chunk-2BJ5HPRD.js";import"./chunk-E4YH2Q2X.js";import{Ca as x,Oa as P,Q as c,Ra as R,Sa as C,V as u,Va as w,W as h,Wa as k,X as _,Xa as G,Ya as n,Za as s,_a as g,a as f,b as y,db as S,ea as d,fb as p,hb as m,ob as v,pb as M,qb as F,ta as b,ua as o,vb as D}from"./chunk-KQCILP4R.js";var $=(a,i)=>i.id;function A(a,i){if(a&1){let e=S();n(0,"div",2)(1,"div",4),p("click",function(){let r=u(e).$implicit,l=m();return h(l.router.navigate([`/generator/${r.id}`]))}),g(2,"canvas",5,0),n(4,"div",6),v(5),s(),n(6,"div",7),p("click",function(r){let l=u(e).$implicit,V=m();return r.stopPropagation(),h(V.handleLike(l.id))}),n(7,"div"),v(8),s(),_(),n(9,"svg",8),g(10,"path",9),s()()()()}if(a&2){let e=i.$implicit,t=m();o(2),G("width",t.size)("height",t.size),o(3),F("#",e.id),o(3),M(e.likes.length),o(2),P("fill",t.isLiked(e.likes)?"currentColor":"none")}}function B(a,i){a&1&&(n(0,"div",3),g(1,"app-loader"),s())}var H=class a{route=c(T);router=c(E);fractal;userService=c(N);galleryService=c(L);currentPage=d(1);loading=d(!1);allRecords=d([]);totalRecords=d(0);galleryRecords=D(()=>this.allRecords());size=340;constructor(){this.fractal=new O}ngOnInit(){this.route.data.subscribe(i=>{let e=i.galleryFirstPage;e&&(this.allRecords.update(t=>[...t,...e.records]),this.totalRecords.set(e.pagination.total),this.currentPage.set(e.pagination.page+1),setTimeout(()=>this.renderFractals(e.records)))})}onScroll(){let e=window.scrollY+window.innerHeight,t=document.body.scrollHeight;e>t-100&&this.loadNextPage()}loadNextPage(){let i=this.totalRecords();this.loading()||i&&this.allRecords().length>=i||(this.loading.set(!0),this.galleryService.get(this.currentPage()).subscribe({next:e=>{this.allRecords.update(t=>[...t,...e.records]),this.totalRecords.set(e.pagination.total),this.currentPage.update(t=>t+1),this.loading.set(!1),setTimeout(()=>this.renderFractals(e.records))},error:()=>{this.loading.set(!1)}}))}renderFractals(i){let e=document.querySelectorAll("canvas");i.forEach((t,r)=>{let l=e[e.length-i.length+r];l&&this.renderFractalToCanvas(l,t.props)})}renderFractalToCanvas(i,e){let t=this.fractal.render(e,this.size,this.size),r=i.getContext("2d");r&&r.putImageData(t,0,0)}isLiked(i){let e=this.userService.user()?.id;return e&&i.includes(e)}handleLike(i){this.galleryService.like(i).subscribe({next:this.updateRecords})}updateRecords=i=>{this.allRecords.update(e=>e.map(t=>{if(t.id===i.id){let r=(t.version||0)+1;return y(f({},i),{version:r})}return t}))};static \u0275fac=function(e){return new(e||a)};static \u0275cmp=x({type:a,selectors:[["app-gallery"]],hostBindings:function(e,t){e&1&&p("scroll",function(){return t.onScroll()},b)},decls:4,vars:1,consts:[["canvas",""],[1,"gallery-container"],[1,"item-container"],[1,"loading"],[1,"item",3,"click"],[3,"width","height"],[1,"index"],[1,"likes",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor"],["d","m12,22c-3.92-3.74-8.46-6.96-10.49-11.55C-1.22,3.94,7.65-1.13,12,4.29c4.35-5.41,13.22-.35,10.49,6.16-2.03,4.59-6.56,7.82-10.49,11.55Z"]],template:function(e,t){e&1&&(n(0,"div",1),w(1,A,11,5,"div",2,$),R(3,B,2,0,"div",3),s()),e&2&&(o(),k(t.galleryRecords()),o(2),C(t.loading()?3:-1))},dependencies:[I],styles:["[_nghost-%COMP%]{width:100%}.gallery-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1rem;padding:1rem}.item-container[_ngcontent-%COMP%]{display:flex;justify-content:center}.item[_ngcontent-%COMP%]{position:relative;display:flex;border-radius:var(--border-radius);overflow:hidden}.index[_ngcontent-%COMP%]{position:absolute;top:.5rem;left:.5rem;border-radius:var(--border-radius);background-color:#8888;line-height:1;padding:.25rem}.likes[_ngcontent-%COMP%]{position:absolute;bottom:.5rem;right:.5rem;border-radius:var(--border-radius);background-color:#8888;padding:.25rem;text-align:center;cursor:pointer}.loading[_ngcontent-%COMP%]{grid-column:1 / -1;text-align:center;padding:1rem}"]})};export{H as PageGallery};
