import{a as $,b as P,c as z,d as Y}from"./chunk-AISLFVIE.js";import{a as L}from"./chunk-6VR75GNB.js";import"./chunk-N65F7NND.js";import{c as R}from"./chunk-2BJ5HPRD.js";import"./chunk-E4YH2Q2X.js";import{$a as n,Ca as V,Ja as I,Q as D,Ua as G,V as d,Va as k,W as m,Wa as F,a as s,ab as c,b as p,bb as M,db as E,ea as w,eb as _,gb as h,hb as x,nb as N,ob as f,qb as T,ra as S,ua as u,wb as O}from"./chunk-KQCILP4R.js";function A(o,e,t){let a=document.createElement("canvas");a.width=e,a.height=t;let r=a.getContext("2d"),i=r.createImageData(e,t),l=o.width/e,C=o.height/t;for(let g=0;g<t;g++)for(let v=0;v<e;v++){let W=Math.floor(v*l),b=(Math.floor(g*C)*o.width+W)*4,y=(g*e+v)*4;i.data[y]=o.data[b],i.data[y+1]=o.data[b+1],i.data[y+2]=o.data[b+2],i.data[y+3]=o.data[b+3]}return r.putImageData(i,0,0),a.toDataURL("image/png")}var U=(o,e)=>e.id;function q(o,e){if(o&1){let t=E();n(0,"img",12),h("click",function(){let r=d(t).$implicit,i=x();return m(i.handleFractal(r.id))}),c()}if(o&2){let t=e.$implicit;_("src",t.icon,S)("alt",t.id)("title",t.id)}}function H(o,e){if(o&1){let t=E();n(0,"div",13),h("click",function(){let r=d(t).$implicit,i=x();return m(i.handlePalette(r))}),c()}if(o&2){let t=e.$implicit,a=x(),r=a.palette[t][0],i=a.palette[t][a.max-1];N(`--from: rgb(${r.r},${r.g},${r.b}); --to: rgb(${i.r},${i.g},${i.b});`)}}var B={fractal:"mandelbrot",p1:2,p2:2,scale:3e4,x:-5e3,y:0,palette:"ocean",invert:!1,fill:!1},X=class o{width=512;height=512;max=50;canvas;ctx;timer=0;fractalData=w(B);fractalName=w(P[B.fractal].name);paletteTypes=z;palette;fractalBtns=$.map(e=>({id:e,icon:P[e].icon}));renderTrigger=w(0);galleryService=D(L);fractal;route=D(R);constructor(){this.fractal=new Y,this.palette=this.fractal.palette;let e=this.route.snapshot.data.fractalRecord;e&&this.fractalData.set(e.props),I(()=>{this.initializeCanvas(),this.renderFractal()}),O(()=>{this.renderTrigger(),this.canvas&&this.renderFractal()})}zoomIn(){this.fractalData.update(e=>p(s({},e),{scale:Math.max(5,Math.floor(e.scale*.8))})),this.renderTrigger.update(e=>e+1)}zoomOut(){this.fractalData.update(e=>p(s({},e),{scale:Math.min(5e4,Math.floor(e.scale*1.2))})),this.renderTrigger.update(e=>e+1)}handlePalette(e){this.fractalData.update(t=>p(s({},t),{palette:e})),this.renderTrigger.update(t=>t+1)}getDefaults(e){return{x:e==="mandelbrot"?-5e3:0,y:0,scale:e==="newton"?5e4:3e4,p1:e==="newton"?1.5:2,p2:e==="newton"?3:2}}handleFractal(e){this.fractalData.update(t=>p(s(s({},t),this.getDefaults(e)),{fractal:e})),this.fractalName.set(P[e].name),this.renderTrigger.update(t=>t+1)}handleFractionalPower(e){this.fractalData.update(t=>p(s({},t),{p1:Number(e)})),this.renderTrigger.update(t=>t+1)}handleAsymmetricalPower(e){this.fractalData.update(t=>p(s({},t),{p2:Number(e)})),this.renderTrigger.update(t=>t+1)}handleInvert(e){this.fractalData.update(t=>p(s({},t),{invert:e})),this.renderTrigger.update(t=>t+1)}handleFill(e){this.fractalData.update(t=>p(s({},t),{fill:e})),this.renderTrigger.update(t=>t+1)}resetView(){this.fractalData.update(e=>s(s({},e),this.getDefaults(e.fractal))),this.renderTrigger.update(e=>e+1)}setCenter=(e,t)=>{let{scale:a,x:r,y:i}=this.fractalData(),l=r/1e4+(e-this.width/2)*(a/1e4)/this.width,C=i/1e4+(t-this.height/2)*(a/1e4)/this.height;this.fractalData.update(g=>p(s({},g),{x:Math.floor(l*1e4),y:Math.floor(C*1e4)}))};handleCanvasClick(e){let t=this.canvas.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top;this.setCenter(a,r)}handleWheel(e){e.preventDefault();let t=Date.now();if(t-this.timer>1e3){let a=this.canvas.getBoundingClientRect(),r=e.clientX-a.left,i=e.clientY-a.top;this.setCenter(r,i),this.timer=t}e.deltaY<0?this.zoomIn():this.zoomOut()}handleSave(){let e=s({},this.fractalData());console.log(e);let t=A(this.fractal.render(e),32,32);this.galleryService.add({props:e,thumbnail:t})}initializeCanvas(){this.canvas=document.querySelector("canvas"),this.ctx=this.canvas.getContext("2d")}renderFractal(){let e=this.fractal.render(this.fractalData(),this.width,this.height);this.ctx.putImageData(e,0,0)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=V({type:o,selectors:[["app-generator"]],decls:31,vars:7,consts:[["canvas",""],[3,"click","wheel","width","height"],[1,"controls"],[1,"btns"],[1,"control_btn",3,"src","alt","title"],["src","./assets/cycle.svg","alt","reset","title","Reset",1,"control_btn",3,"click"],["type","range","min","0.5","max","4","step","0.5",3,"input","value"],[1,"color_btn",3,"style"],["src","./assets/invert.svg","alt","invert","title","Invert",1,"control_btn"],["type","checkbox",2,"display","none",3,"change"],["src","./assets/fill.svg","alt","fill","title","Fill",1,"control_btn"],[1,"button",3,"click"],[1,"control_btn",3,"click","src","alt","title"],[1,"color_btn",3,"click"]],template:function(t,a){if(t&1){let r=E();n(0,"canvas",1,0),h("click",function(l){return d(r),m(a.handleCanvasClick(l))})("wheel",function(l){return d(r),m(a.handleWheel(l))}),c(),n(2,"div",2)(3,"label"),f(4),c(),n(5,"div",3),k(6,q,1,3,"img",4,U),n(8,"img",5),h("click",function(){return d(r),m(a.resetView())}),c()(),n(9,"label")(10,"div"),f(11),c(),n(12,"input",6),h("input",function(l){return d(r),m(a.handleFractionalPower(l.target.value))}),c()(),n(13,"label")(14,"div"),f(15),c(),n(16,"input",6),h("input",function(l){return d(r),m(a.handleAsymmetricalPower(l.target.value))}),c()(),n(17,"label"),f(18,"Color"),c(),n(19,"div",3),k(20,H,1,2,"div",7,G),c(),n(22,"div",3)(23,"label"),M(24,"img",8),n(25,"input",9),h("change",function(l){return d(r),m(a.handleInvert(l.target.checked))}),c()(),n(26,"label"),M(27,"img",10),n(28,"input",9),h("change",function(l){return d(r),m(a.handleFill(l.target.checked))}),c()()(),n(29,"button",11),h("click",function(){return d(r),m(a.handleSave())}),f(30,"Save"),c()()}if(t&2){_("width",a.width)("height",a.height);let r=a.fractalData();u(4),T(" Fractal: ",a.fractalName()," "),u(2),F(a.fractalBtns),u(5),T("Fractional Power: ",r.p1),u(),_("value",r.p1),u(3),T("Asymmetrical Power: ",r.p2),u(),_("value",r.p2),u(4),F(a.paletteTypes)}},styles:["[_nghost-%COMP%]{min-height:calc(100dvh - 6rem);display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;align-items:center}.controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;row-gap:.5rem}.btns[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}canvas[_ngcontent-%COMP%]{border:var(--border-thickness) solid var(--color40);border-radius:var(--border-radius);box-shadow:0 0 15px #6dd5fa66}.control_btn[_ngcontent-%COMP%], .color_btn[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:var(--border-radius);cursor:pointer;transition:transform .25s linear,box-shadow .25s linear;box-shadow:2px 2px 3px #888}[_ngcontent-%COMP%]:is(.control_btn,.color_btn):hover{transform:translate(1px,1px);box-shadow:1px 1px 2px #888}.control_btn[_ngcontent-%COMP%]{background-color:#222;filter:invert(var(--color-scheme))}.color_btn[_ngcontent-%COMP%]{--from: #000;--to: #fff;background:linear-gradient(var(--from),var(--to))}"]})};export{X as PageGenerator};
