import{a as A,b as C,c as B,d as W}from"./chunk-H76PA2PH.js";import"./chunk-BYXBJQAS.js";import{a as X}from"./chunk-X4YI4MQ5.js";import"./chunk-NZYCSRIY.js";import{c as Y}from"./chunk-NF2NXLZV.js";import"./chunk-3UOA546C.js";import{$a as o,Bb as L,Ca as R,Cb as $,Ja as I,Q as D,Ua as N,V as d,Va as k,W as m,Wa as M,a as c,ab as s,b as p,bb as F,db as x,ea as y,eb as _,gb as h,hb as T,lb as z,mb as G,pb as O,qb as v,ra as V,sb as P,ua as u,yb as S}from"./chunk-UNKFYFRK.js";function Q(l,e,t){let a=document.createElement("canvas");a.width=e,a.height=t;let r=a.getContext("2d"),n=r.createImageData(e,t),i=l.width/e,f=l.height/t;for(let g=0;g<t;g++)for(let b=0;b<e;b++){let q=Math.floor(b*i),w=(Math.floor(g*f)*l.width+q)*4,E=(g*e+b)*4;n.data[E]=l.data[w],n.data[E+1]=l.data[w+1],n.data[E+2]=l.data[w+2],n.data[E+3]=l.data[w+3]}return r.putImageData(n,0,0),a.toDataURL("image/png")}var J=["canvas"],K=(l,e)=>e.id;function Z(l,e){if(l&1){let t=x();o(0,"img",13),h("click",function(){let r=d(t).$implicit,n=T();return m(n.handleFractal(r.id))}),s()}if(l&2){let t=e.$implicit;_("src",t.icon,V)("alt",t.id)("title",t.id)}}function ee(l,e){if(l&1){let t=x();o(0,"div",14),h("click",function(){let r=d(t).$implicit,n=T();return m(n.handlePalette(r))}),s()}if(l&2){let t=e.$implicit,a=T(),r=a.palette[t][0],n=a.palette[t][a.max-1];O(`--from: rgb(${r.r},${r.g},${r.b}); --to: rgb(${n.r},${n.g},${n.b});`)}}var j={fractal:"mandelbrot",p1:2,p2:2,scale:3e4,x:-5e3,y:0,palette:"ocean",invert:!1,fill:!1},U=class l{size=L(512);width=512;height=512;max=50;canvasElement=$("canvas");timer=0;fractalData=y(j);fractalName=y(C[j.fractal].name);paletteTypes=B;palette;fractalBtns=A.map(e=>({id:e,icon:C[e].icon}));renderTrigger=y(0);galleryService=D(X);fractal;route=D(Y);constructor(){this.fractal=new W,this.palette=this.fractal.palette;let e=this.route.snapshot.data.fractalRecord;e&&this.fractalData.set(e.props),I(()=>{this.setupResizeListener(),this.renderFractal()}),S(()=>{this.renderTrigger(),this.renderFractal()}),S(()=>{let t=this.size();this.width=t,this.height=t})}setupResizeListener(){let e=new ResizeObserver(a=>{for(let r of a)this.handleResize(r.contentRect.width)}),t=this.canvasElement()?.nativeElement.parentElement;t&&e.observe(t)}handleResize(e){let t=window.devicePixelRatio||1,a=this.canvasElement()?.nativeElement;if(a){let r=a.getContext("2d");r&&r.scale(t,t)}}zoomIn(){this.fractalData.update(e=>p(c({},e),{scale:Math.max(5,Math.floor(e.scale*.8))})),this.renderTrigger.update(e=>e+1)}zoomOut(){this.fractalData.update(e=>p(c({},e),{scale:Math.min(5e4,Math.floor(e.scale*1.2))})),this.renderTrigger.update(e=>e+1)}handlePalette(e){this.fractalData.update(t=>p(c({},t),{palette:e})),this.renderTrigger.update(t=>t+1)}getDefaults(e){return{x:e==="mandelbrot"?-5e3:0,y:0,scale:e==="newton"?5e4:3e4,p1:e==="newton"?1.5:2,p2:e==="newton"?3:2}}handleFractal(e){this.fractalData.update(t=>p(c(c({},t),this.getDefaults(e)),{fractal:e})),this.fractalName.set(C[e].name),this.renderTrigger.update(t=>t+1)}handleFractionalPower(e){this.fractalData.update(t=>p(c({},t),{p1:Number(e)})),this.renderTrigger.update(t=>t+1)}handleAsymmetricalPower(e){this.fractalData.update(t=>p(c({},t),{p2:Number(e)})),this.renderTrigger.update(t=>t+1)}handleInvert(e){this.fractalData.update(t=>p(c({},t),{invert:e})),this.renderTrigger.update(t=>t+1)}handleFill(e){this.fractalData.update(t=>p(c({},t),{fill:e})),this.renderTrigger.update(t=>t+1)}resetView(){this.fractalData.update(e=>c(c({},e),this.getDefaults(e.fractal))),this.renderTrigger.update(e=>e+1)}setCenter=(e,t)=>{let{scale:a,x:r,y:n}=this.fractalData(),i=r/1e4+(e-this.width/2)*(a/1e4)/this.width,f=n/1e4+(t-this.height/2)*(a/1e4)/this.height;this.fractalData.update(g=>p(c({},g),{x:Math.floor(i*1e4),y:Math.floor(f*1e4)}))};handleCanvasClick(e){let t=this.canvasElement()?.nativeElement;if(t){let a=t.getBoundingClientRect(),r=this.width/a.width,n=this.height/a.height,i=(e.clientX-a.left)*r,f=(e.clientY-a.top)*n;this.setCenter(i,f)}}handleWheel(e){e.preventDefault();let t=Date.now();if(t-this.timer>1e3){let a=this.canvasElement()?.nativeElement;if(a){let r=a.getBoundingClientRect(),n=this.width/r.width,i=this.height/r.height,f=(e.clientX-r.left)*n,g=(e.clientY-r.top)*i;this.setCenter(f,g),this.timer=t}}e.deltaY<0?this.zoomIn():this.zoomOut()}handleSave(){let e=c({},this.fractalData());console.log(e);let t=Q(this.fractal.render(e),32,32);this.galleryService.add({props:e,thumbnail:t})}renderFractal(){let e=this.canvasElement()?.nativeElement;if(e){let t=e.getContext("2d");if(t){let a=this.fractal.render(this.fractalData(),this.width,this.height);t.putImageData(a,0,0)}}}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=R({type:l,selectors:[["app-generator"]],viewQuery:function(t,a){t&1&&z(a.canvasElement,J,5),t&2&&G()},inputs:{size:[1,"size"]},decls:32,vars:7,consts:[["canvas",""],[1,"canvas-container"],[3,"click","wheel","width","height"],[1,"controls"],[1,"btns"],[1,"control_btn",3,"src","alt","title"],["src","./assets/cycle.svg","alt","reset","title","Reset",1,"control_btn",3,"click"],["type","range","min","0.5","max","4","step","0.5",3,"input","value"],[1,"color_btn",3,"style"],["src","./assets/invert.svg","alt","invert","title","Invert",1,"control_btn"],["type","checkbox",2,"display","none",3,"change"],["src","./assets/fill.svg","alt","fill","title","Fill",1,"control_btn"],[1,"button",3,"click"],[1,"control_btn",3,"click","src","alt","title"],[1,"color_btn",3,"click"]],template:function(t,a){if(t&1){let r=x();o(0,"div",1)(1,"canvas",2,0),h("click",function(i){return d(r),m(a.handleCanvasClick(i))})("wheel",function(i){return d(r),m(a.handleWheel(i))}),s()(),o(3,"div",3)(4,"label"),v(5),s(),o(6,"div",4),k(7,Z,1,3,"img",5,K),o(9,"img",6),h("click",function(){return d(r),m(a.resetView())}),s()(),o(10,"label")(11,"div"),v(12),s(),o(13,"input",7),h("input",function(i){return d(r),m(a.handleFractionalPower(i.target.value))}),s()(),o(14,"label")(15,"div"),v(16),s(),o(17,"input",7),h("input",function(i){return d(r),m(a.handleAsymmetricalPower(i.target.value))}),s()(),o(18,"label"),v(19,"Color"),s(),o(20,"div",4),k(21,ee,1,2,"div",8,N),s(),o(23,"div",4)(24,"label"),F(25,"img",9),o(26,"input",10),h("change",function(i){return d(r),m(a.handleInvert(i.target.checked))}),s()(),o(27,"label"),F(28,"img",11),o(29,"input",10),h("change",function(i){return d(r),m(a.handleFill(i.target.checked))}),s()()(),o(30,"button",12),h("click",function(){return d(r),m(a.handleSave())}),v(31,"Save"),s()()}if(t&2){u(),_("width",a.width)("height",a.height);let r=a.fractalData();u(4),P(" Fractal: ",a.fractalName()," "),u(2),M(a.fractalBtns),u(5),P("Fractional Power: ",r.p1),u(),_("value",r.p1),u(3),P("Asymmetrical Power: ",r.p2),u(),_("value",r.p2),u(4),M(a.paletteTypes)}},styles:["[_nghost-%COMP%]{min-height:calc(100dvh - 6rem);display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;align-items:center}.controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;row-gap:.5rem}.btns[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.canvas-container[_ngcontent-%COMP%]{max-width:512px;flex-grow:1;aspect-ratio:1;border:var(--border-thickness) solid var(--color40);border-radius:var(--border-radius);box-shadow:0 0 15px #6dd5fa66}canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block}.control_btn[_ngcontent-%COMP%], .color_btn[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:var(--border-radius);cursor:pointer;transition:transform .25s linear,box-shadow .25s linear;box-shadow:2px 2px 3px #888}[_ngcontent-%COMP%]:is(.control_btn,.color_btn):hover{transform:translate(1px,1px);box-shadow:1px 1px 2px #888}.control_btn[_ngcontent-%COMP%]{background-color:#222;filter:invert(var(--color-scheme))}.color_btn[_ngcontent-%COMP%]{--from: #000;--to: #fff;background:linear-gradient(var(--from),var(--to))}"]})};export{U as PageGenerator};
